{"version":3,"mappings":"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","names":["MAIN_MENU_ID","THEMES","PIECE_THEMES","BOARD_THEMES","EventEmitter","__publicField","listener","idx","event","_listeners","urlIcon","icon","pieceTheme","ariaDescriptionFromIcon","setTitle","newTitle","setMeta","name","newValue","setupSEO","template","params","page","Configuration","_stockfishDepth","_stockfishMultiPV","_preventScreenOff","_colorTheme","_playSounds","_fullScreen","_highlightSquares","_pieceTheme","_boardTheme","_selectionUrl","value","DEFAULT_CONFIG","StorageService","Storage","Drivers","key","storageService","ConfigurationService","resolve","config","cfg","configurationService","tryDefine","impl","tag","initialize","IonAlert","IonApp","IonButton","IonButtons","IonCardContent","IonCardHeader","IonCard","IonCardTitle","IonCol","IonContent","IonFabButton","IonFab","IonFabList","IonFooter","IonGrid","IonHeader","IonIcon","IonInput","IonItem","IonLabel","IonMenuButton","IonMenu","IonMenuToggle","IonModal","IonRange","IonRippleEffect","IonRouterLink","IonRouterOutlet","IonRow","IonSegmentButton","IonSegment","IonSplitPane","IonTitle","IonToast","IonToggle","IonToolbar","images","redrawIconImages","el","url","RouteService","menuId","query","menu","menuController","navigo","targetElementSelector","controller","targetElement","elementObserver","mutations","_mutation","content","response","routeItem","xData","pageMode","autoHeight","info","element","component","modal","modalController","data","routeMap","Navigo","mainRoute","route","oRoute","done","_match","canExit","routeService","ThemeSwitcherService","theme","_a","_b","themeSwitcherService","BoardThemeSwitcherService","themeDefinition","item","style","boardThemeSwitcherService","StockfishService","message","engineUrl","nnue","self","mem","result","sourceWithSimd","stockfishListener","features","stockfishService","SoundService","sound","soundToPlay","soundJson","Howl","soundService","AlpineService","loaderContainer","browserLang","candidate","created","i18nJson","Alpine","AlpineI18n","alpineService","services_initialize","BaseController","_info","_$routeParams","AboutController","version","aboutJson","aboutController","SettingsController","boardTheme","checked","toastController","toggleHighlightSquares","togglePlaySounds","stockfishDepthRange","stockfishMultiPVRange","_value","settingsController","AppController","appController","HomeController","homeController","PromotionController","player","piece","promotionController","PositionController","Chess","selectCandidate","__vitePreload","error","header","container","boardWrapper","gauge","infoWrapper","actionButtons","containerWidth","containerHeight","minSize","board","mod","boardSize","pgn","parts","pos","part","moves","dests","SQUARES","ms","m","$routeParams","customFen","fen","turnWhite","turnColor","move","colors","orig","dest","_metadata","gaugeTop","gaugeBottom","Chessground","source","target","promotion","candidates","selected","positiveScores","negativeScores","minPositiveScore","minPositiveCandidates","randomIndex","maxNegativeScore","maxNegativeCandidates","match","from","to","turn","depth","score","pv","ev","blackHeight","whiteHeight","alertController","color","diff","cp","mate","signed","evMate","evCp","positionController","ROUTE_MAP"],"sources":["../../src/commons/constants.ts","../../src/commons/event-emitter.ts","../../src/commons/utils.ts","../../src/model/configuration.ts","../../src/services/storage-service.ts","../../src/services/configuration-service.ts","../../src/services/ionic.ts","../../src/services/route-service.ts","../../src/services/theme-switcher-service.ts","../../src/services/board-theme-switcher-service.ts","../../src/services/stockfish-service.ts","../../src/services/sound-service.ts","../../src/services/alpine-service.ts","../../src/services/services.ts","../../src/controllers/controller.ts","../../src/controllers/about.ts","../../src/controllers/settings.ts","../../src/controllers/app.ts","../../src/controllers/home.ts","../../src/controllers/promotion.ts","../../src/controllers/position.ts","../../src/routes.ts","../../src/main.ts"],"sourcesContent":["export const MAIN_MENU_ID = 'main-menu';\nexport const THEMES = [\n    {\n        'name': 'dark',\n        'class': 'dark',\n        'mainColor': '#000000'\n    },\n    {\n        'name': 'light',\n        'class': '',\n        'mainColor': '#ffffff'\n    }\n];\n\nexport const PIECE_THEMES = ['alpha', 'california', 'cburnett', 'chess7', 'chessnut', 'chicago', 'companion', 'fantasy', 'iowa', 'kosal', 'leipzig', 'letter', 'merida', 'mono', 'oslo', 'pirouetti', 'pixel', 'reilly', 'riohacha', 'shapes', 'spatial', 'symmetric'];\n\nexport const BOARD_THEMES = [\n    {\n      'name': 'brown',\n      'styles': [\n        { 'themeVariable': '--chess-white-background', 'value': '#F3E1C2' },\n        { 'themeVariable': '--chess-white-color', 'value': '#C39976' },\n        { 'themeVariable': '--chess-black-background', 'value': '#C39976' },\n        { 'themeVariable': '--chess-black-color', 'value': '#F3E1C2' },\n      ]\n    },\n    {\n      'name': 'blue',\n      'styles': [\n        { 'themeVariable': '--chess-white-background', 'value': '#E4E9EB' },\n        { 'themeVariable': '--chess-white-color', 'value': '#9DB1BB' },\n        { 'themeVariable': '--chess-black-background', 'value': '#9DB1BB' },\n        { 'themeVariable': '--chess-black-color', 'value': '#E4E9EB' },\n      ]\n    },\n    {\n      'name': 'green',\n      'styles': [\n        { 'themeVariable': '--chess-white-background', 'value': '#FFFEE4' },\n        { 'themeVariable': '--chess-white-color', 'value': '#97B378' },\n        { 'themeVariable': '--chess-black-background', 'value': '#97B378' },\n        { 'themeVariable': '--chess-black-color', 'value': '#FFFEE4' },\n      ]\n    },\n    {\n      'name': 'grey',\n      'styles': [\n        { 'themeVariable': '--chess-white-background', 'value': '#AAAAAA' },\n        { 'themeVariable': '--chess-white-color', 'value': '#888888' },\n        { 'themeVariable': '--chess-black-background', 'value': '#888888' },\n        { 'themeVariable': '--chess-black-color', 'value': '#AAAAAA' },\n      ]\n    },\n    {\n      'name': 'pink',\n      'styles': [\n        { 'themeVariable': '--chess-white-background', 'value': '#FFF2F2' },\n        { 'themeVariable': '--chess-white-color', 'value': '#BC4545' },\n        { 'themeVariable': '--chess-black-background', 'value': '#BC4545' },\n        { 'themeVariable': '--chess-black-color', 'value': '#FFF2F2' },\n      ]\n    },\n    {\n      'name': 'navy',\n      'styles': [\n        { 'themeVariable': '--chess-white-background', 'value': '#ECECEC' },\n        { 'themeVariable': '--chess-white-color', 'value': '#385170' },\n        { 'themeVariable': '--chess-black-background', 'value': '#385170' },\n        { 'themeVariable': '--chess-black-color', 'value': '#ECECEC' },\n      ]\n    },\n    {\n      'name': 'dark-green',\n      'styles': [\n        { 'themeVariable': '--chess-white-background', 'value': '#E0EFBA' },\n        { 'themeVariable': '--chess-white-color', 'value': '#467A4B' },\n        { 'themeVariable': '--chess-black-background', 'value': '#467A4B' },\n        { 'themeVariable': '--chess-black-color', 'value': '#E0EFBA' },\n      ]\n    },\n    {\n      'name': 'black-white',\n      'styles': [\n        { 'themeVariable': '--chess-white-background', 'value': '#F2F2F2' },\n        { 'themeVariable': '--chess-white-color', 'value': '#0C0C0C' },\n        { 'themeVariable': '--chess-black-background', 'value': '#0C0C0C' },\n        { 'themeVariable': '--chess-black-color', 'value': '#F2F2F2' },\n      ]\n    }\n  ];","export class EventEmitter<T> {\n  private _listeners: ((event: T) => void)[] = [];\n\n  constructor() { }\n\n  public addEventListener(listener: (event: T) => void) {\n    if (!this._listeners.includes(listener)) {\n      this._listeners.push(listener);\n    }\n  }\n\n  public removeEventListener(listener: (event: T) => void) {\n    const idx = this._listeners.indexOf(listener);\n    if (idx !== -1) {\n      this._listeners.splice(idx, 1);\n    }\n  }\n\n  public removeListeners() {\n    this._listeners = [];\n  }\n\n  public notify(event: T) {\n    this._listeners.forEach((_listeners) => {\n      _listeners(event);\n    });\n  }\n}\n","export const textToImages = (text: string) => {\n    const result: string[] = [];\n    const words = text.split(\" \");\n    let cont = 1;\n    let themeColor = document.querySelector('body')?.classList.contains('dark') ? 'w' : 'b';\n    let color = 'w';\n    words.forEach(word => {\n        let image;\n        word = word.toUpperCase();\n        if (word == 'ONE') {\n            cont = 1;\n        } else if (word == 'TWO') {\n            cont = 2;\n        } else if (word == 'THREE') {\n            image = `${themeColor}3.svg`;\n            result.push(image);\n            cont = 1;\n        } else if (word == 'FOUR') {\n            image = `${themeColor}4.svg`;\n            result.push(image);\n            cont = 1;\n        } else if (word == 'FIVE') {\n            image = `${themeColor}5.svg`;\n            result.push(image);\n            cont = 1;\n        } else if (word == 'VS') {\n            image = `${themeColor}swords.svg`;\n            result.push(image);\n            color = 'b';\n        } else if (word.lastIndexOf('KING', 0) === 0) {\n            for (let x = cont; x > 0; x--) {\n                image = `${color}K.svg`\n                result.push(image);\n            }\n            cont = 1;\n        } else if (word.lastIndexOf('QUEEN', 0) === 0) {\n            for (let x = cont; x > 0; x--) {\n                image = `${color}Q.svg`\n                result.push(image);\n            }\n            cont = 1;\n        } else if (word.lastIndexOf('ROOK', 0) === 0) {\n            for (let x = cont; x > 0; x--) {\n                image = `${color}R.svg`\n                result.push(image);\n            }\n            cont = 1;\n        } else if (word.lastIndexOf('BISHOP', 0) === 0) {\n            for (let x = cont; x > 0; x--) {\n                image = `${color}B.svg`\n                result.push(image);\n            }\n            cont = 1;\n        } else if (word.lastIndexOf('KNIGHT', 0) === 0) {\n            for (let x = cont; x > 0; x--) {\n                image = `${color}N.svg`\n                result.push(image);\n            }\n            cont = 1;\n        } else if (word.lastIndexOf('PAWN', 0) === 0) {\n            for (let x = cont; x > 0; x--) {\n                image = `${color}P.svg`\n                result.push(image);\n            }\n            cont = 1;\n        }\n    });\n    return result;\n};\n\nexport const urlIcon = (icon: string, pieceTheme: string) => {\n    return `assets/pieces/${pieceTheme}/${icon}`;\n};\n\nexport const ariaDescriptionFromIcon = (icon: string) => {\n    if (icon.endsWith('3.svg')) return 'three';\n    else if (icon.endsWith('4.svg')) return 'four';\n    else if (icon.endsWith('5.svg')) return 'five';\n    else if (icon.endsWith('elementary.svg')) return 'elementary';\n    else if (icon.endsWith('swords.svg')) return 'against';\n    else if (icon.endsWith('B.svg')) return 'bishop';\n    else if (icon.endsWith('K.svg')) return 'king';\n    else if (icon.endsWith('N.svg')) return 'knight';\n    else if (icon.endsWith('P.svg')) return 'pawn';\n    else if (icon.endsWith('Q.svg')) return 'queen';\n    else if (icon.endsWith('R.svg')) return 'rook';\n    else return 'unknown';\n};\n\nexport const clone = (object: any) => {\n    return JSON.parse(JSON.stringify(object));\n};\n\nconst setTitle = (newTitle: string) => {\n    window.document.title = newTitle;\n};\n\nconst setMeta = (name: string, newValue: string) => {\n    (window.document.getElementsByName(name)[0] as HTMLMetaElement).content = newValue;\n}\n\nexport const setupSEO = (template: string, params: any) => {\n    const page = template.replace('.html', '');\n    setTitle(window.AlpineI18n.t(`${page}.seo.title`, params));\n    setMeta('description', window.AlpineI18n.t(`${page}.seo.meta_description`, params));\n};","import { BOARD_THEMES, PIECE_THEMES, EventEmitter } from '../commons';\n\nexport type ConfigurationField =\n\n    'stockfishDepth' | 'stockfishMultiPV' | 'preventScreenOff' | 'colorTheme' | 'playSounds' | 'fullScreen' | 'highlightSquares' | 'pieceTheme' | 'boardTheme' | 'selectionUrl';\n\nexport class Configuration {\n\n    private _configurationChangedEmitter: EventEmitter<{ config: Configuration, field: ConfigurationField }> = new EventEmitter<{ config: Configuration, field: ConfigurationField }>();\n\n    constructor(\n        private _stockfishDepth: number,\n        private _stockfishMultiPV: number,\n        private _preventScreenOff: boolean,\n        private _colorTheme: string,\n        private _playSounds: boolean,\n        private _fullScreen: boolean,\n        private _highlightSquares: boolean,\n        private _pieceTheme: string,\n        private _boardTheme: string,\n        private _selectionUrl: string\n    ) { }\n\n    public serialize() {\n        return {\n            stockfishDepth: this._stockfishDepth,\n            stockfishMultiPV: this._stockfishMultiPV,\n            preventScreenOff: this._preventScreenOff,\n            colorTheme: this._colorTheme,\n            playSounds: this._playSounds,\n            fullScreen: this._fullScreen,\n            highlightSquares: this._highlightSquares,\n            pieceTheme: this._pieceTheme,\n            boardTheme: this._boardTheme,\n            selectionUrl: this._selectionUrl\n        };\n    }\n\n    get configuration(): Configuration { return this; }\n    get configurationChangedEmitter(): EventEmitter<{ config: Configuration, field: ConfigurationField }> { return this._configurationChangedEmitter; }\n\n    get stockfishDepth(): number { return this._stockfishDepth; }\n    set stockfishDepth(value: number) { if (this._stockfishDepth != value) { this._stockfishDepth = value; this._configurationChangedEmitter.notify({ config: this, field: 'stockfishDepth' }); } }\n\n    get stockfishMultiPV(): number { return this._stockfishMultiPV; }\n    set stockfishMultiPV(value: number) { if (this._stockfishMultiPV != value) { this._stockfishMultiPV = value; this._configurationChangedEmitter.notify({ config: this, field: 'stockfishMultiPV' }); } }\n\n    get preventScreenOff(): boolean { return this._preventScreenOff; }\n    set preventScreenOff(value: boolean) { if (this._preventScreenOff != value) { this._preventScreenOff = value; this._configurationChangedEmitter.notify({ config: this, field: 'preventScreenOff' }); } }\n\n    get colorTheme(): string { return this._colorTheme; }\n    set colorTheme(value: string) { if (this._colorTheme != value) { this._colorTheme = value; this._configurationChangedEmitter.notify({ config: this, field: 'colorTheme' }); } }\n\n    get playSounds(): boolean { return this._playSounds; }\n    set playSounds(value: boolean) { if (this._playSounds != value) { this._playSounds = value; this._configurationChangedEmitter.notify({ config: this, field: 'playSounds' }); } }\n\n    get fullScreen(): boolean { return this._fullScreen; }\n    set fullScreen(value: boolean) { if (this._fullScreen != value) { this._fullScreen = value; this._configurationChangedEmitter.notify({ config: this, field: 'fullScreen' }); } }\n\n    get highlightSquares(): boolean { return this._highlightSquares; }\n    set highlightSquares(value: boolean) { if (this._highlightSquares != value) { this._highlightSquares = value; this._configurationChangedEmitter.notify({ config: this, field: 'highlightSquares' }); } }\n\n    get pieceTheme(): string { return this._pieceTheme; }\n    set pieceTheme(value: string) { if (this._pieceTheme != value) { this._pieceTheme = value; this._configurationChangedEmitter.notify({ config: this, field: 'pieceTheme' }); } }\n\n    get boardTheme(): string { return this._boardTheme; }\n    set boardTheme(value: string) { if (this._boardTheme != value) { this._boardTheme = value; this._configurationChangedEmitter.notify({ config: this, field: 'boardTheme' }); } }\n\n    get selectionUrl(): string { return this._selectionUrl; }\n    set selectionUrl(value: string) { if (this._selectionUrl != value) { this._selectionUrl = value; this._configurationChangedEmitter.notify({ config: this, field: 'selectionUrl' }); } }\n\n}\n\nexport const DEFAULT_CONFIG = new Configuration(\n    15,\n    10,\n    true,\n    'dark',\n    true,\n    true,\n    true,\n    PIECE_THEMES[0],\n    BOARD_THEMES[0].name,\n    'https://gist.githubusercontent.com/supertorpe/c18a5f320db997e52f25aecac5f9ceb1/raw/54f4acb908dce74b94641d4d1f1ed3a035452375/equalizing-chess-selection.js'\n);\n","import { Drivers, Storage } from '@ionic/storage';\n\nclass StorageService {\n    private store = new Storage({ name: 'CET_STORAGE', driverOrder: [ Drivers.IndexedDB, Drivers.LocalStorage ] });\n\n    public async init(): Promise<any> {\n        return this.store.create();\n    }\n\n    public get(key: string) {\n        return this.store.get(key);\n    }\n    \n    public set(key: string, value: any) {\n        return this.store.set(key, value);\n    }\n    \n    public remove(key: string) {\n        return this.store.remove(key);\n    }\n\n}\n\nexport const storageService = new StorageService();\n","import { Configuration, DEFAULT_CONFIG } from '../model';\nimport { storageService } from './storage-service';\n\nclass ConfigurationService {\n\n    private _configuration!: Configuration;\n\n    get configuration(): Configuration { return this._configuration; }\n\n    constructor() { }\n\n    public init(): Promise<Configuration> {\n        return new Promise<Configuration>(resolve => {\n            storageService.get('CONFIGURATION').then(config => {\n                if (config) {\n                    if (config.stockfishDepth === undefined) config.stockfishDepth = DEFAULT_CONFIG.stockfishDepth;\n                    if (config.stockfishMultiPV === undefined) config.stockfishMultiPV = DEFAULT_CONFIG.stockfishMultiPV;\n                    if (config.preventScreenOff === undefined) config.preventScreenOff = DEFAULT_CONFIG.preventScreenOff;\n                    if (config.colorTheme === undefined) config.colorTheme = DEFAULT_CONFIG.colorTheme;\n                    if (config.playSounds === undefined) config.playSounds = DEFAULT_CONFIG.playSounds;\n                    if (config.fullScreen === undefined) config.fullScreen = DEFAULT_CONFIG.fullScreen;\n                    if (config.highlightSquares === undefined) config.highlightSquares = DEFAULT_CONFIG.highlightSquares;\n                    if (config.pieceTheme === undefined) config.pieceTheme = DEFAULT_CONFIG.pieceTheme;\n                    if (config.boardTheme === undefined) config.boardTheme = DEFAULT_CONFIG.boardTheme;\n                    if (config.selectionUrl === undefined) config.selectionUrl = DEFAULT_CONFIG.selectionUrl;\n                    this._configuration = new Configuration(\n                        config.stockfishDepth,\n                        config.stockfishMultiPV,\n                        config.preventScreenOff,\n                        config.colorTheme,\n                        config.playSounds,\n                        config.fullScreen,\n                        config.highlightSquares,\n                        config.pieceTheme,\n                        config.boardTheme,\n                        config.selectionUrl\n                    );\n                    resolve(this._configuration);\n                } else {\n                    this._configuration = DEFAULT_CONFIG;\n                    this.save().then(cfg => {\n                        resolve(cfg);\n                    });\n                }\n            });\n        });\n    }\n\n    public save(): Promise<Configuration> {\n        return storageService.set('CONFIGURATION', this._configuration.serialize());\n    }\n\n}\n\nexport const configurationService = new ConfigurationService();\n","import { initialize } from '@ionic/core/components';\n\n// import { IonAccordionGroup } from '@ionic/core/components/ion-accordion-group';\n// import { IonAccordion } from '@ionic/core/components/ion-accordion';\n// import { IonActionSheet } from '@ionic/core/components/ion-action-sheet';\nimport { IonAlert } from '@ionic/core/components/ion-alert';\nimport { IonApp } from '@ionic/core/components/ion-app';\n// import { IonAvatar } from '@ionic/core/components/ion-avatar';\n//import { IonBackButton } from '@ionic/core/components/ion-back-button';\n// import { IonBackdrop } from '@ionic/core/components/ion-backdrop';\n// import { IonBadge } from '@ionic/core/components/ion-badge';\n// import { IonBreadcrumb } from '@ionic/core/components/ion-breadcrumb';\n// import { IonBreadcrumbs } from '@ionic/core/components/ion-breadcrumbs';\nimport { IonButton } from '@ionic/core/components/ion-button';\nimport { IonButtons } from '@ionic/core/components/ion-buttons';\nimport { IonCardContent } from '@ionic/core/components/ion-card-content';\nimport { IonCardHeader } from '@ionic/core/components/ion-card-header';\nimport { IonCard } from '@ionic/core/components/ion-card';\n//import { IonCardSubtitle } from '@ionic/core/components/ion-card-subtitle';\nimport { IonCardTitle } from '@ionic/core/components/ion-card-title';\n//import { IonCheckbox } from '@ionic/core/components/ion-checkbox';\n// import { IonChip } from '@ionic/core/components/ion-chip';\nimport { IonCol } from '@ionic/core/components/ion-col';\nimport { IonContent } from '@ionic/core/components/ion-content';\n// import { IonDatetime } from '@ionic/core/components/ion-datetime';\nimport { IonFabButton } from '@ionic/core/components/ion-fab-button';\nimport { IonFab } from '@ionic/core/components/ion-fab';\nimport { IonFabList } from '@ionic/core/components/ion-fab-list';\nimport { IonFooter } from '@ionic/core/components/ion-footer';\nimport { IonGrid } from '@ionic/core/components/ion-grid';\nimport { IonHeader } from '@ionic/core/components/ion-header';\nimport { IonIcon } from '@ionic/core/components/ion-icon';\n// import { IonImg } from '@ionic/core/components/ion-img';\n// import { IonInfiniteScrollContent } from '@ionic/core/components/ion-infinite-scroll-content';\n// import { IonInfiniteScroll } from '@ionic/core/components/ion-infinite-scroll';\nimport { IonInput } from '@ionic/core/components/ion-input';\n// import { IonItemDivider } from '@ionic/core/components/ion-item-divider';\n// import { IonItemGroup } from '@ionic/core/components/ion-item-group';\nimport { IonItem } from '@ionic/core/components/ion-item';\n// import { IonItemOption } from '@ionic/core/components/ion-item-option';\n// import { IonItemOptions } from '@ionic/core/components/ion-item-options';\n// import { IonItemSliding } from '@ionic/core/components/ion-item-sliding';\nimport { IonLabel } from '@ionic/core/components/ion-label';\n//import { IonListHeader } from '@ionic/core/components/ion-list-header';\n//import { IonList } from '@ionic/core/components/ion-list';\n// import { IonLoading } from '@ionic/core/components/ion-loading';\nimport { IonMenuButton } from '@ionic/core/components/ion-menu-button';\nimport { IonMenu } from '@ionic/core/components/ion-menu';\nimport { IonMenuToggle } from '@ionic/core/components/ion-menu-toggle';\nimport { IonModal } from '@ionic/core/components/ion-modal';\n// import { IonNav } from '@ionic/core/components/ion-nav';\n// import { IonNavLink } from '@ionic/core/components/ion-nav-link';\n// import { IonNote } from '@ionic/core/components/ion-note';\n// import { IonPickerColumnInternal } from '@ionic/core/components/ion-picker-column-internal';\n// import { IonPickerColumn } from '@ionic/core/components/ion-picker-column';\n// import { IonPickerInternal } from '@ionic/core/components/ion-picker-internal';\n// import { IonPicker } from '@ionic/core/components/ion-picker';\n// import { IonPopover } from '@ionic/core/components/ion-popover';\n// import { IonProgressBar } from '@ionic/core/components/ion-progress-bar';\n// import { IonRadioGroup } from '@ionic/core/components/ion-radio-group';\n// import { IonRadio } from '@ionic/core/components/ion-radio';\nimport { IonRange } from '@ionic/core/components/ion-range';\n// import { IonRefresherContent } from '@ionic/core/components/ion-refresher-content';\n// import { IonRefresher } from '@ionic/core/components/ion-refresher';\n//import { IonReorderGroup } from '@ionic/core/components/ion-reorder-group';\n//import { IonReorder } from '@ionic/core/components/ion-reorder';\nimport { IonRippleEffect } from '@ionic/core/components/ion-ripple-effect';\n// import { IonRoute } from '@ionic/core/components/ion-route';\n// import { IonRouteRedirect } from '@ionic/core/components/ion-route-redirect';\n// import { IonRouter } from '@ionic/core/components/ion-router';\nimport { IonRouterLink } from '@ionic/core/components/ion-router-link';\nimport { IonRouterOutlet } from '@ionic/core/components/ion-router-outlet';\nimport { IonRow } from '@ionic/core/components/ion-row';\n// import { IonSearchbar } from '@ionic/core/components/ion-searchbar';\nimport { IonSegmentButton } from '@ionic/core/components/ion-segment-button';\nimport { IonSegment } from '@ionic/core/components/ion-segment';\n//import { IonSelect } from '@ionic/core/components/ion-select';\n//import { IonSelectOption } from '@ionic/core/components/ion-select-option';\n// import { IonSelectPopover } from '@ionic/core/components/ion-select-popover';\n// import { IonSkeletonText } from '@ionic/core/components/ion-skeleton-text';\n// import { IonSlide } from '@ionic/core/components/ion-slide';\n// import { IonSlides } from '@ionic/core/components/ion-slides';\n// import { IonSpinner } from '@ionic/core/components/ion-spinner';\nimport { IonSplitPane } from '@ionic/core/components/ion-split-pane';\n// import { IonTabBar } from '@ionic/core/components/ion-tab-bar';\n// import { IonTabButton } from '@ionic/core/components/ion-tab-button';\n// import { IonTab } from '@ionic/core/components/ion-tab';\n// import { IonTabs } from '@ionic/core/components/ion-tabs';\n//import { IonTextarea } from '@ionic/core/components/ion-textarea';\n//import { IonText } from '@ionic/core/components/ion-text';\n// import { IonThumbnail } from '@ionic/core/components/ion-thumbnail';\nimport { IonTitle } from '@ionic/core/components/ion-title';\nimport { IonToast } from '@ionic/core/components/ion-toast';\nimport { IonToggle } from '@ionic/core/components/ion-toggle';\nimport { IonToolbar } from '@ionic/core/components/ion-toolbar';\n// import { IonVirtualScroll } from '@ionic/core/components/ion-virtual-scroll';\n\ndocument.documentElement.classList.add('ion-ce');\n\nfunction tryDefine(impl: CustomElementConstructor, tag: string) {\n  try {\n    customElements.define(tag, impl);\n  } catch (error) {}\n}\n\ninitialize(/*{mode:'ios'}*/);\n\n// tryDefine(IonAccordionGroup, 'ion-accordion-group');\n// tryDefine(IonAccordion, 'ion-accordion');\n// tryDefine(IonActionSheet, 'ion-action-sheet');\ntryDefine(IonAlert, 'ion-alert');\ntryDefine(IonApp, 'ion-app');\n// tryDefine(IonAvatar, 'ion-avatar');\n//tryDefine(IonBackButton, 'ion-back-button');\n// tryDefine(IonBackdrop, 'ion-backdrop');\n// tryDefine(IonBadge, 'ion-badge');\n// tryDefine(IonBreadcrumb, 'ion-breadcrumb');\n// tryDefine(IonBreadcrumbs, 'ion-breadcrumbs');\ntryDefine(IonButton, 'ion-button');\ntryDefine(IonButtons, 'ion-buttons');\ntryDefine(IonCardContent, 'ion-card-content');\ntryDefine(IonCardHeader, 'ion-card-header');\ntryDefine(IonCard, 'ion-card');\n//tryDefine(IonCardSubtitle, 'ion-card-subtitle');\ntryDefine(IonCardTitle, 'ion-card-title');\n//tryDefine(IonCheckbox, 'ion-checkbox');\n// tryDefine(IonChip, 'ion-chip');\ntryDefine(IonCol, 'ion-col');\ntryDefine(IonContent, 'ion-content');\n// tryDefine(IonDatetime, 'ion-datetime');\ntryDefine(IonFabButton, 'ion-fab-button');\ntryDefine(IonFab, 'ion-fab');\ntryDefine(IonFabList, 'ion-fab-list');\ntryDefine(IonFooter, 'ion-footer');\ntryDefine(IonGrid, 'ion-grid');\ntryDefine(IonHeader, 'ion-header');\ntryDefine(IonIcon, 'ion-icon');\n// tryDefine(IonImg, 'ion-img');\n// tryDefine(IonInfiniteScrollContent, 'ion-infinite-scroll-content');\n// tryDefine(IonInfiniteScroll, 'ion-infinite-scroll');\ntryDefine(IonInput, 'ion-input');\n// tryDefine(IonItemDivider, 'ion-item-divider');\n// tryDefine(IonItemGroup, 'ion-item-group');\ntryDefine(IonItem, 'ion-item');\n// tryDefine(IonItemOption, 'ion-item-option');\n// tryDefine(IonItemOptions, 'ion-item-options');\n// tryDefine(IonItemSliding, 'ion-item-sliding');\ntryDefine(IonLabel, 'ion-label');\n//tryDefine(IonListHeader, 'ion-list-header');\n//tryDefine(IonList, 'ion-list');\n// tryDefine(IonLoading, 'ion-loading');\ntryDefine(IonMenuButton, 'ion-menu-button');\ntryDefine(IonMenu, 'ion-menu');\ntryDefine(IonMenuToggle, 'ion-menu-toggle');\ntryDefine(IonModal, 'ion-modal');\n// tryDefine(IonNav, 'ion-nav');\n// tryDefine(IonNavLink, 'ion-nav-link');\n// tryDefine(IonNote, 'ion-note');\n// tryDefine(IonPickerColumnInternal, 'ion-picker-column-internal');\n// tryDefine(IonPickerColumn, 'ion-picker-column');\n// tryDefine(IonPickerInternal, 'ion-picker-internal');\n// tryDefine(IonPicker, 'ion-picker');\n// tryDefine(IonPopover, 'ion-popover');\n// tryDefine(IonProgressBar, 'ion-progress-bar');\n// tryDefine(IonRadioGroup, 'ion-radio-group');\n// tryDefine(IonRadio, 'ion-radio');\ntryDefine(IonRange, 'ion-range');\n// tryDefine(IonRefresherContent, 'ion-refresher-content');\n// tryDefine(IonRefresher, 'ion-refresher');\n//tryDefine(IonReorderGroup, 'ion-reorder-group');\n//tryDefine(IonReorder, 'ion-reorder');\ntryDefine(IonRippleEffect, 'ion-ripple-effect');\n// tryDefine(IonRoute, 'ion-route');\n// tryDefine(IonRouteRedirect, 'ion-route-redirect');\n// tryDefine(IonRouter, 'ion-router');\ntryDefine(IonRouterLink, 'ion-router-link');\ntryDefine(IonRouterOutlet, 'ion-router-outlet');\ntryDefine(IonRow, 'ion-row');\n// tryDefine(IonSearchbar, 'ion-searchbar');\ntryDefine(IonSegmentButton, 'ion-segment-button');\ntryDefine(IonSegment, 'ion-segment');\n//tryDefine(IonSelect, 'ion-select');\n//tryDefine(IonSelectOption, 'ion-select-option');\n// tryDefine(IonSelectPopover, 'ion-select-popover');\n// tryDefine(IonSkeletonText, 'ion-skeleton-text');\n// tryDefine(IonSlide, 'ion-slide');\n// tryDefine(IonSlides, 'ion-slides');\n// tryDefine(IonSpinner, 'ion-spinner');\ntryDefine(IonSplitPane, 'ion-split-pane');\n// tryDefine(IonTabBar, 'ion-tab-bar');\n// tryDefine(IonTabButton, 'ion-tab-button');\n// tryDefine(IonTab, 'ion-tab');\n// tryDefine(IonTabs, 'ion-tabs');\n//tryDefine(IonTextarea, 'ion-textarea');\n//tryDefine(IonText, 'ion-text');\n// tryDefine(IonThumbnail, 'ion-thumbnail');\ntryDefine(IonTitle, 'ion-title');\ntryDefine(IonToast, 'ion-toast');\ntryDefine(IonToggle, 'ion-toggle');\ntryDefine(IonToolbar, 'ion-toolbar');\n// tryDefine(IonVirtualScroll, 'ion-virtual-scroll');\n\nconst images = import.meta.glob('/node_modules/@ionic/core/dist/ionic/svg/(close|home-sharp|information-circle|settings-sharp|save|caret-down|caret-forward|caret-up|arrow-back|arrow-forward|power|swap-vertical|arrow-undo|bulb|color-wand|flag).svg', { as: 'url' });\nexport const redrawIconImages = () => {\n  document.querySelectorAll('ion-icon').forEach((el) => {\n      const name = el.getAttribute('data-name');\n      if (name != null) {\n        images[`/node_modules/@ionic/core/dist/ionic/svg/${name}.svg`]().then((url: string) => {\n          el.src = url;\n        });\n      }\n    });\n};\n","\nimport Navigo from 'navigo';\nimport { MenuI, menuController, modalController } from '@ionic/core';\nimport { Controller } from '../controllers';\nimport { MAIN_MENU_ID, setupSEO } from '../commons';\nimport { redrawIconImages } from './ionic';\n\ninterface RouteItem {\n    path: string;\n    template: string;\n    tag: string;\n    controller: Controller;\n    hasParams: boolean;\n}\n\ninterface RouteMap {\n    hash: boolean,\n    mainRoute: RouteItem;\n    routes: RouteItem[];\n}\n\nclass RouteService {\n\n    private navigo!: Navigo;\n    private menuRegistered = false;\n    private templates = new Map<string, string>();\n    \n    private closeMenu = (menuId: string) => {\n        if (!this.menuRegistered) {\n            const query = \"ion-menu[menu-id='\" + menuId + \"']\";\n            const menu = document.querySelector(query) as unknown as MenuI;\n            if (!menu) return;\n            menuController._register(menu);\n            this.menuRegistered = true;\n        }\n        menuController.close(menuId);\n    }\n\n    private openRoute = (navigo: Navigo, template: string, targetElementSelector: string, controller: Controller, params?: any): Promise<void> => {\n        this.closeMenu(MAIN_MENU_ID);\n        return new Promise<void>(resolve => {\n            const targetElement = document.querySelector(targetElementSelector);\n            if (targetElement) {\n                const elementObserver = new MutationObserver((mutations) => {\n                    mutations.forEach((_mutation) => {\n                        if (controller) {\n                            elementObserver.disconnect();\n                            redrawIconImages();\n                            navigo.updatePageLinks();\n                            resolve();\n                        }\n                    });\n                });\n                elementObserver.observe(targetElement, { childList: true });\n                controller.onEnter(params);\n                const content = this.templates.get(template);\n                if (content) {\n                    targetElement.innerHTML = content;\n                    setupSEO(template, controller.getSEOParams());\n                } else {\n                    fetch(template)\n                        .then(response => response.text()\n                            .then(content => {\n                                this.templates.set(template, content);\n                                targetElement.innerHTML = content;\n                                setupSEO(template, controller.getSEOParams());\n                                redrawIconImages();\n                            }));\n                }\n            }\n        });\n    }\n\n    private open(routeItem: RouteItem): (params?: any) => Promise<void> {\n        if (routeItem.hasParams) {\n            return (params: any) => this.openRoute(this.navigo, routeItem.template, routeItem.tag, routeItem.controller, params);\n        } else {\n            return () => this.openRoute(this.navigo, routeItem.template, routeItem.tag, routeItem.controller);\n        }\n    }\n\n    public openModal(xData: string, template: string, controller: Controller, pageMode: boolean, autoHeight: boolean, info?: any): Promise<any> {\n        const element = document.createElement('div');\n        element.setAttribute('x-data', xData);\n        const content = this.templates.get(template);\n        if (content) {\n            element.innerHTML = content;\n            return this.innerOpenModal(element, controller, pageMode, autoHeight, info);\n        } else {\n            return fetch(template)\n                .then(response => response.text()\n                    .then(async content => {\n                        this.templates.set(template, content);\n                        element.innerHTML = content;\n                        return this.innerOpenModal(element, controller, pageMode, autoHeight, info);\n                    }));\n        }\n    }\n\n    private async innerOpenModal(component: HTMLElement, controller: Controller, pageMode: boolean, autoHeight: boolean, info?: any): Promise<any> {\n        const modal = await modalController.create({ component: component });\n        if (autoHeight) modal.style.setProperty('--height', 'auto');\n        if (info) controller.setInfo(info);\n        controller.onEnter(info);\n        modal.present().then(() => { redrawIconImages(); });\n        // remove ion-page class on the next tick, when the DOM of the modal has been loaded\n        if (!pageMode) {\n            requestAnimationFrame(() => {\n                if (!pageMode) component.classList.remove('ion-page');\n            });\n        }\n        const { data } = await modal.onDidDismiss();\n        return data;\n    }\n\n    public updatePageLinks() {\n        this.navigo.updatePageLinks();\n    }\n\n    public init(routeMap: RouteMap) {\n        this.navigo = new Navigo(routeMap.mainRoute.path, { hash: routeMap.hash });\n        const mainRoute = this.open(routeMap.mainRoute);\n        routeMap.routes.forEach((route) => {\n            const oRoute = this.open(route);\n            if (route.hasParams) {\n                this.navigo.on(route.path, (info: any) => {\n                    document.querySelector(route.tag) ? oRoute(info.data) : mainRoute().then(() => oRoute(info.data));\n                }, {\n                    leave(done, _match) {\n                        route.controller.onExit().then((canExit: boolean) => done(canExit));\n                    }\n                });\n            } else {\n                this.navigo.on(route.path, () => {\n                    document.querySelector(route.tag) ? oRoute() : mainRoute().then(() => oRoute());\n                });\n            }\n        });\n        this.navigo.resolve();\n    }\n}\n\nexport const routeService = new RouteService();","import { THEMES } from '../commons';\nimport { configurationService } from './configuration-service';\n\nclass ThemeSwitcherService {\n\n    public getThemes() {\n        return THEMES;\n    }\n\n    public setTheme(theme: string) {\n        if ('dark' == theme)\n            document.querySelector('body')?.classList.add('dark');\n        else\n            document.querySelector('body')?.classList.remove('dark');\n    }\n\n    public currentTheme() {\n        return document.querySelector('body')?.classList.contains('dark') ? 'dark' : 'light';\n    }\n\n    public init() {\n        this.setTheme(configurationService.configuration.colorTheme);\n    }\n}\n\nexport const themeSwitcherService = new ThemeSwitcherService();\n","import { BOARD_THEMES } from '../commons';\nimport { configurationService } from './configuration-service';\n\nclass BoardThemeSwitcherService {\n\n    public getThemes() {\n        return BOARD_THEMES;\n    }\n\n    public setTheme(theme: string) {\n        const themeDefinition = BOARD_THEMES.find(item => item.name == theme);\n        if (themeDefinition) themeDefinition.styles.forEach(style => {\n            document.documentElement.style.setProperty(style.themeVariable, style.value);\n          });\n    }\n\n    public currentTheme() {\n        return configurationService.configuration.boardTheme;\n    }\n\n    public init() {\n        this.setTheme(this.currentTheme());\n    }\n}\n\nexport const boardThemeSwitcherService = new BoardThemeSwitcherService();\n","import { EventEmitter } from '../commons';\n\ndeclare var WebAssembly: any;\n\nclass StockfishService {\n\n    private stockfish: any;\n    private _version!: string;\n    private _messageEmitter: EventEmitter<string> = new EventEmitter<string>();\n\n    constructor() { }\n\n    get version(): string { return this._version; }\n    get messageEmitter(): EventEmitter<string> { return this._messageEmitter; }\n\n    public postMessage(message: string) {\n        this.stockfish.postMessage(message);\n    }\n\n    private initStockfish(engineUrl: string, nnue: boolean) {\n        const self = this;\n        this.stockfish = new Worker(engineUrl);\n        this.stockfish.addEventListener('message', function (event: MessageEvent<string>) {\n            self._messageEmitter.notify(event.data);\n        });\n        this.stockfish.postMessage('uci');\n        if (nnue) this.stockfish.postMessage('setoption name Use NNUE value true');\n    }\n\n    private async initStockfishNnue16() {\n        this.initStockfish('assets/stockfish/stockfish-nnue-16.js#stockfish-nnue-16.wasm', true);\n    }\n\n    private initStockfishNnue16NoSimd() {\n        this.initStockfish('assets/stockfish/stockfish-nnue-16-no-simd.js#stockfish-nnue-16-no-simd.wasm', true);\n    }\n\n    private initStockfishNnue16Single() {\n        this.initStockfish('assets/stockfish/stockfish-nnue-16-single.js#stockfish-nnue-16-single.wasm', true);\n    }\n\n    private initStockfishJs() {\n        this.initStockfish('assets/stockfish/stockfish.asm.js', false);\n    }\n\n    private sharedMemoryTest(): boolean {\n        if (typeof Atomics !== 'object') return false;\n        if (typeof SharedArrayBuffer !== 'function') return false;\n        let mem;\n        try {\n            mem = new WebAssembly.Memory({ shared: true, initial: 1, maximum: 2 });\n            if (!(mem.buffer instanceof SharedArrayBuffer)) return false;\n\n            window.postMessage(mem.buffer, '*');\n        } catch (_) {\n            return false;\n        }\n        return mem.buffer instanceof SharedArrayBuffer;\n    }\n\n    private detectFeatures(): string[] {\n        const result: string[] = [];\n        if (typeof WebAssembly === 'object' &&\n            typeof WebAssembly.validate === 'function' &&\n            WebAssembly.validate(Uint8Array.from([0, 97, 115, 109, 1, 0, 0, 0]))) {\n            result.push('wasm');\n            if (this.sharedMemoryTest()) {\n                result.push('sharedMem');\n                // i32x4.dot_i16x8_s, i32x4.trunc_sat_f64x2_u_zero\n                const sourceWithSimd = Uint8Array.from([0, 97, 115, 109, 1, 0, 0, 0, 1, 12, 2, 96, 2, 123, 123, 1, 123, 96, 1, 123, 1, 123, 3, 3, 2, 0, 1, 7, 9, 2, 1, 97, 0, 0, 1, 98, 0, 1, 10, 19, 2, 9, 0, 32, 0, 32, 1, 253, 186, 1, 11, 7, 0, 32, 0, 253, 253, 1, 11]); // prettier-ignore\n                if (WebAssembly.validate(sourceWithSimd)) result.push('simd');\n            }\n        }\n        return result;\n    }\n\n    public init(): Promise<boolean> {\n        return new Promise(resolve => {\n            const stockfishListener = (message: string) => {\n                if (!this._version) this._version = message;\n                console.log(message);\n                if ('uciok' == message) {\n                    //this._messageEmitter.removeEventListener(stockfishListener);\n                    resolve(true);\n                }\n            }\n            this._messageEmitter.addEventListener(stockfishListener);\n            const features = this.detectFeatures();\n            if (features.includes(\"simd\"))\n                this.initStockfishNnue16();\n            else if (features.includes(\"sharedMem\")) {\n                this.initStockfishNnue16NoSimd();\n            } else if (features.includes(\"wasm\")) {\n                this.initStockfishNnue16Single();\n            } else {\n                this.initStockfishJs();\n            }\n        });\n    }\n\n}\n\nexport const stockfishService = new StockfishService();\n","import { Howl } from 'howler';\n\nimport { configurationService } from './configuration-service';\nimport { soundJson } from '../static';\n\ntype SOUND_ITEM = {\n    key: string,\n    audio: Howl\n}\n\nclass SoundService {\n\n    private sounds: SOUND_ITEM[] = [];\n\n    public playAudio(sound: string) {\n        if (configurationService.configuration.playSounds) {\n            const soundToPlay = this.sounds.find((item) => { return item.key === sound; });\n            if (soundToPlay && (sound !== 'fail' || !soundToPlay.audio.playing())) {\n                soundToPlay.audio.play();\n            }\n        }\n    }\n\n    public init() {\n        soundJson.sounds.forEach(item => this.sounds.push({ key: item.key, audio: new Howl({ src: [item.audio] }) }))\n    }\n}\n\nexport const soundService = new SoundService();\n","import AlpineI18n from 'alpinejs-i18n';\nimport Alpine from 'alpinejs';\nimport { i18nJson } from '../static';\n\nclass AlpineService {\n\n    private hideLoader() {\n        const loaderContainer = document.querySelector('.loader-container');\n        if (loaderContainer) { loaderContainer.remove(); }\n    }\n\n    private i18n() {\n        document.addEventListener('alpine-i18n:ready', () => {\n            const browserLang = navigator.language;\n            let candidate = '';\n            let created = false;\n            Object.keys(i18nJson).forEach((key) => {\n                if (!window.AlpineI18n.fallbackLocale) {\n                    window.AlpineI18n.fallbackLocale = key;\n                }\n                if (!created) {\n                    if (key == browserLang) {\n                        window.AlpineI18n.create(key, i18nJson);\n                        created = true;\n                        document.documentElement.lang = key;\n                    } else if (!candidate && browserLang.startsWith(key)) {\n                        candidate = key;\n                    }\n                }\n            });\n            if (!created) {\n                if (candidate) {\n                    window.AlpineI18n.create(candidate, i18nJson);\n                    document.documentElement.lang = candidate;\n                } else {\n                    window.AlpineI18n.create(window.AlpineI18n.fallbackLocale, i18nJson);\n                    document.documentElement.lang = window.AlpineI18n.fallbackLocale;\n                }\n            }\n        });\n    }\n\n    public init() {\n        this.i18n();\n        Alpine.plugin(AlpineI18n);\n        Alpine.start();\n        this.hideLoader();\n    }\n\n}\n\nexport const alpineService = new AlpineService();\n","import './ionic';\nimport { storageService } from './storage-service';\nimport { configurationService } from './configuration-service';\nimport { alpineService } from './alpine-service';\nimport { themeSwitcherService } from './theme-switcher-service';\nimport { boardThemeSwitcherService } from './board-theme-switcher-service';\nimport { stockfishService } from './stockfish-service';\nimport { soundService } from './sound-service';\n\nexport function services_initialize() {\n    return storageService.init()\n        .then(() => configurationService.init())\n        .then(() => stockfishService.init())\n        .then(() => soundService.init())\n        .then(() => themeSwitcherService.init())\n        .then(() => boardThemeSwitcherService.init())\n        .then(() => alpineService.init())\n        ;\n\n}\n","export interface Controller {\n    setInfo(info: any): void;\n    getSEOParams(): any;\n    onEnter($routeParams?: any): void;\n    onExit(): Promise<boolean>;\n}\n\nexport class BaseController implements Controller {\n    setInfo(_info: any) {\n    }\n    getSEOParams(): any {\n        return {};\n    }\n    onEnter(_$routeParams?: any): void {\n    }\n    onExit(): Promise<boolean> {\n        return new Promise<boolean>(resolve => { resolve(true); });\n    }\n}\n\nexport const dummyController = new BaseController();","import Alpine from 'alpinejs';\nimport { version } from '../../package.json';\nimport { BaseController } from './controller';\nimport { aboutJson } from '../static';\nimport { stockfishService } from '../services';\n\nclass AboutController extends BaseController {\n    onEnter(_$routeParams?: any): void {\n        Alpine.data('info', () => ({\n            version: version,\n            items: aboutJson.items.map(item => { return {url: item.url, text: window.AlpineI18n.t(item.i18n, {'stockfishRunningVersion': stockfishService.version}) } })\n        }));\n    }\n}\n\nexport const aboutController = new AboutController();\n","import { PIECE_THEMES, BOARD_THEMES } from '../commons';\nimport { redrawIconImages, themeSwitcherService, configurationService, boardThemeSwitcherService } from '../services';\nimport { BaseController } from './controller';\nimport Alpine from 'alpinejs';\nimport { toastController } from '@ionic/core';\nimport { IonModal } from '@ionic/core/components/ion-modal';\nimport { IonToggle } from '@ionic/core/components/ion-toggle';\nimport { IonRange } from '@ionic/core/components/ion-range';\n\nclass SettingsController extends BaseController {\n    onEnter(_$routeParams?: any): void {\n\n        Alpine.data('settings', () => ({\n            color: themeSwitcherService.currentTheme() == 'dark' ? 'w' : 'b',\n            // theme\n            showThemes: false,\n            themes: themeSwitcherService.getThemes(),\n            currentTheme() {\n                return configurationService.configuration.colorTheme;\n            },\n            toggleThemes() {\n                this.showThemes = !this.showThemes;\n                this.showPieceThemes = false;\n                this.showBoardThemes = false;\n            },\n            setTheme(theme: string) {\n                themeSwitcherService.setTheme(theme);\n                configurationService.configuration.colorTheme = theme;\n                this.color = themeSwitcherService.currentTheme() == 'dark' ? 'w' : 'b';\n            },\n            // piece theme\n            showPieceThemes: false,\n            pieceThemes: PIECE_THEMES,\n            currentPieceTheme: configurationService.configuration.pieceTheme,\n            togglePieceThemes() {\n                this.showPieceThemes = !this.showPieceThemes;\n                this.showThemes = false;\n                this.showBoardThemes = false;\n            },\n            setPieceTheme(pieceTheme: string) {\n                this.currentPieceTheme = pieceTheme;\n                configurationService.configuration.pieceTheme = pieceTheme;\n            },\n            // board theme\n            showBoardThemes: false,\n            boardThemes: BOARD_THEMES,\n            currentBoardTheme: configurationService.configuration.boardTheme,\n            toggleBoardThemes() {\n                this.showBoardThemes = !this.showBoardThemes;\n                this.showThemes = false;\n                this.showPieceThemes = false;\n\n            },\n            setBoardTheme(boardTheme: string) {\n                this.currentBoardTheme = boardTheme;\n                configurationService.configuration.boardTheme = boardTheme;\n                boardThemeSwitcherService.setTheme(boardTheme);\n            },\n            // play sounds\n            playSounds: configurationService.configuration.playSounds,\n            playSoundsChanged(checked: boolean) {\n                this.playSounds = checked;\n                configurationService.configuration.playSounds = checked;\n            },\n            // highlight squares\n            highlightSquares: configurationService.configuration.highlightSquares,\n            highlightSquaresChanged(checked: boolean) {\n                this.highlightSquares = checked;\n                configurationService.configuration.highlightSquares = checked;\n            },\n            // stockfish depth\n            currentStockfishDepth: configurationService.configuration.stockfishDepth,\n            changeStockfishDepth(value: number) {\n                this.currentStockfishDepth = value;\n                configurationService.configuration.stockfishDepth = value;  \n            },\n            // stockfish MultiPV\n            currentStockfishMultiPV: configurationService.configuration.stockfishMultiPV,\n            changeStockfishMultiPV(value: number) {\n                this.currentStockfishMultiPV = value;\n                configurationService.configuration.stockfishMultiPV = value;  \n            },\n            // selectionUrl\n            currentSelectionUrl: configurationService.configuration.selectionUrl,\n            changeSelectionUrl() {\n                const value = (document.getElementById('inputSelectionUrl') as HTMLInputElement).value;\n                this.currentSelectionUrl = value;\n                configurationService.configuration.selectionUrl = value;\n            },\n            // save settings\n            save() {\n                configurationService.save().then(async () => {\n                    const toast = await toastController.create({\n                        message: window.AlpineI18n.t('settings.changes-saved'),\n                        position: 'middle',\n                        color: 'success',\n                        duration: 1000\n                    });\n                    toast.present();\n                    this.close();\n                });\n            },\n            close() {\n                (document.querySelector('ion-modal') as IonModal).dismiss();\n            },\n            init() {\n                const toggleHighlightSquares = document.getElementById('toggleHighlightSquares') as IonToggle;\n                toggleHighlightSquares.addEventListener('ionChange', () => { this.highlightSquaresChanged(toggleHighlightSquares.checked); });\n                \n                const togglePlaySounds = document.getElementById('togglePlaySounds') as IonToggle;\n                togglePlaySounds.addEventListener('ionChange', () => { this.playSoundsChanged(togglePlaySounds.checked); });\n                \n                const stockfishDepthRange = document.getElementById('stockfishDepthRange') as IonRange;\n                stockfishDepthRange.value = configurationService.configuration.stockfishDepth;\n                stockfishDepthRange.addEventListener('ionChange', () => {\n                    if (typeof stockfishDepthRange.value ===  'number') this.changeStockfishDepth(stockfishDepthRange.value);\n                });\n\n                const stockfishMultiPVRange = document.getElementById('stockfishMultiPVRange') as IonRange;\n                stockfishMultiPVRange.value = configurationService.configuration.stockfishMultiPV;\n                stockfishMultiPVRange.addEventListener('ionChange', () => {\n                    if (typeof stockfishMultiPVRange.value ===  'number') this.changeStockfishMultiPV(stockfishMultiPVRange.value);\n                });   \n\n                ['showThemes', 'showPieceThemes', 'showBoardThemes'].forEach((item) => {\n                    this.$watch(item, (_value) => {\n                        redrawIconImages();\n                    });\n                });\n                (document.getElementById('stockfishDepthRange') as IonRange).pinFormatter = value => value;\n                (document.getElementById('stockfishMultiPVRange') as IonRange).pinFormatter = value => value;\n            }\n        }));\n    }\n}\n\nexport const settingsController = new SettingsController();\n","import Alpine from 'alpinejs';\nimport { BaseController } from './controller';\nimport { routeService } from '../services';\nimport { settingsController } from './settings';\n\nclass AppController extends BaseController {\n    onEnter(_$routeParams?: any): void {\n        Alpine.data('info',  () => ({\n            showSettings() {\n                routeService.openModal('settings', 'settings.html', settingsController, true, false);\n            },\n            init() {\n            }\n        }));\n    }\n}\n\nexport const appController = new AppController();\n","import Alpine from 'alpinejs';\nimport { BaseController } from './controller';\nimport { urlIcon } from '../commons';\nimport { configurationService } from '../services';\n\nclass HomeController extends BaseController {\n\n    onEnter(_$routeParams?: any): void {\n        const pieceTheme = configurationService.configuration.pieceTheme;\n        Alpine.data('info', () => ({\n            iconWhite: urlIcon('wP.svg', pieceTheme),\n            iconBlack: urlIcon('bP.svg', pieceTheme),\n            init() {\n                configurationService.configuration.configurationChangedEmitter.addEventListener((event) => {\n                    if (event.field == 'pieceTheme') {\n                        this.iconWhite = urlIcon('wP.svg', event.config.pieceTheme),\n                        this.iconBlack = urlIcon('bP.svg', event.config.pieceTheme)\n                    }\n                });\n            }\n        }));\n    }\n}\n\nexport const homeController = new HomeController();\n","import { BaseController } from './controller';\nimport Alpine from 'alpinejs';\nimport { IonModal } from '@ionic/core/components/ion-modal';\nimport { configurationService } from '../services';\n\nclass PromotionController extends BaseController {\n    private player!: string\n    setInfo(player: string) {\n        this.player = player;\n    }\n    onEnter(_$routeParams?: any): void {\n        Alpine.data('promotion', () => ({\n            player: this.player,\n            currentPieceTheme: configurationService.configuration.pieceTheme,\n            select(piece: string) {\n                (document.querySelector('ion-modal') as IonModal).dismiss({piece: piece});\n            }\n        }));\n    }\n}\n\nexport const promotionController = new PromotionController();\n","import Alpine from 'alpinejs';\nimport { BaseController } from './controller';\nimport { configurationService, routeService, soundService, stockfishService } from '../services';\nimport { ariaDescriptionFromIcon } from '../commons';\nimport { Chess, ChessInstance, PieceType, SQUARES, Square } from 'chess.js';\nimport { Chessground } from 'chessground';\nimport { Api } from 'chessground/api';\nimport { colors, MoveMetadata, Color, Key } from 'chessground/types';\nimport { Config } from 'chessground/config';\nimport { promotionController } from './promotion';\nimport { alertController } from '@ionic/core';\n\ntype Candidate = { score: number, pv: string };\n\nclass PositionController extends BaseController {\n\n  private seo!: string;\n  private chess: ChessInstance = Chess();\n  private board!: Api;\n  private boardConfig!: Config;\n  private parsedPgn!: string[][];\n  private player!: \"white\" | \"black\";\n  private engine!: \"white\" | \"black\";\n  private listeningToStockfish = false;\n  private stockfishMessageBuffer: Candidate[] = [];\n  private selectCandidateFunction!: (candidates: Candidate[]) => Candidate | undefined;\n\n  constructor() {\n    super();\n    stockfishService.messageEmitter.addEventListener((message: string) => this.stockfishMessage(message));\n  }\n\n  private async loadSelectionFunction() {\n    try {\n      const response = await fetch(configurationService.configuration.selectionUrl);\n      const content = await response.text();\n      const { selectCandidate } = await import(/* @vite-ignore */`data:text/javascript;charset=utf-8,${encodeURIComponent(content)}`);\n      this.selectCandidateFunction = selectCandidate;\n    } catch (error) {\n      console.log(error);\n      alert('Error loading selection function. Using default algorithm');\n      this.selectCandidateFunction = this.selectEqualizingCandidate;\n    }\n  }\n\n  private resizeBoard() {\n    const headers = Array.from(document.querySelectorAll('ion-header')) as HTMLElement[];\n    const header = headers.find(header => header.clientHeight > 0);\n    if (!header) return;\n    const container = document.querySelector('.container') as HTMLElement;\n    const boardWrapper = document.querySelector('.board_wrapper') as HTMLElement;\n    const gauge = document.querySelector('.gauge') as HTMLElement;\n    const infoWrapper = document.querySelector('.info_wrapper') as HTMLElement;\n    const actionButtons = document.querySelector('.action_buttons') as HTMLElement;\n    const containerWidth = container.clientWidth;\n    const containerHeight = container.clientHeight - header.clientHeight;\n    let minSize = Math.min(containerWidth, containerHeight);\n    boardWrapper.style.height = `${minSize}px`;\n    boardWrapper.style.width = `${minSize}px`;\n    if (containerWidth > containerHeight) {\n      infoWrapper.style.width = `${(containerWidth - minSize - 2)}px`;\n      infoWrapper.style.height = '100%';\n    } else {\n      infoWrapper.style.width = '100%';\n      infoWrapper.style.height = `${(containerHeight - minSize - 2)}px`;\n    }\n    actionButtons.style.width = infoWrapper.style.width;\n    const board: any = document.getElementById('__chessboard__');\n    const mod = boardWrapper.clientWidth % 8;\n    let boardSize = boardWrapper.clientWidth - mod;\n    if (boardWrapper.clientWidth - boardSize < 4) boardSize = boardSize - 8;\n    board.style.height = `${boardSize}px`;\n    board.style.width = `${boardSize}px`;\n    gauge.style.height = `${boardSize}px`;\n    gauge.style.width = `${boardWrapper.clientWidth - boardSize}px`;\n  }\n\n  private parsePgn(pgn: string) {\n    this.parsedPgn = [];\n    if (pgn == '')\n      return;\n    const parts = pgn.split('.');\n    let pos = 0;\n    parts.forEach(part => {\n      if (pos > 0) {\n        let moves = part.trim().split(' ', 2);\n        this.parsedPgn.push(moves);\n      }\n      pos++;\n    });\n  }\n\n  private toDests(): Map<Key, Key[]> {\n    const dests = new Map();\n    SQUARES.forEach(s => {\n      const ms = this.chess.moves({ square: s, verbose: true });\n      if (ms.length) dests.set(s, ms.map(m => m.to));\n    });\n    return dests;\n  }\n\n  onEnter($routeParams?: any): void {\n    const self = this;\n    if (!this.selectCandidateFunction) this.loadSelectionFunction();\n    const customFen = ($routeParams['fen1'] !== undefined);\n    let fen: string;\n    if (customFen) {\n      fen = `${$routeParams['fen1']}/${$routeParams['fen2']}/${$routeParams['fen3']}/${$routeParams['fen4']}/${$routeParams['fen5']}/${$routeParams['fen6']}/${$routeParams['fen7']}/${$routeParams['fen8']}`;\n    } else {\n      fen = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1';\n    }\n    this.seo = fen;\n\n    this.chess.load(fen);\n    this.parsePgn(this.chess.pgn());\n\n    const turnWhite = this.chess.turn() == 'w';\n    const turnColor: Color = (turnWhite ? 'white' : 'black');\n    const move = (turnWhite ? 'white' : 'black');\n    this.player = $routeParams['color'] || (this.chess.turn() == 'w' ? colors[0] : colors[1]);\n    this.engine = this.player == 'white' ? 'black' : 'white';\n    this.boardConfig = {\n      fen: this.chess.fen(),\n      orientation: this.player,\n      viewOnly: false,\n      turnColor: turnColor,\n      premovable: {\n        enabled: false\n      },\n      movable: {\n        free: false,\n        color: turnColor,\n        dests: this.toDests(),\n        showDests: configurationService.configuration.highlightSquares,\n        events: {\n          after: (orig: Key, dest: Key, _metadata: MoveMetadata) => { this.afterMove(orig, dest); }\n        }\n      },\n      highlight: {\n        lastMove: true,\n        check: true\n      },\n      draggable: {\n        enabled: true,\n        autoDistance: true,\n        showGhost: true\n      },\n      selectable: {\n        enabled: true\n      }\n    };\n    window.addEventListener('resize', function () {\n      self.resizeBoard();\n    });\n\n    Alpine.data('info', () => ({\n      boardTheme: configurationService.configuration.boardTheme,\n      pieceTheme: configurationService.configuration.pieceTheme,\n      customFen: customFen,\n      fen: fen,\n      parsedPgn: self.parsedPgn,\n      move: move,\n      ariaDescriptionFromIcon: ariaDescriptionFromIcon,\n      chess: this.chess,\n      init() {\n        const gaugeTop = document.querySelector('.gauge_top') as HTMLElement;\n        const gaugeBottom = document.querySelector('.gauge_bottom') as HTMLElement;\n        gaugeTop.style.backgroundColor = (self.player == 'white' ? 'dimgray' : 'white');\n        gaugeBottom.style.backgroundColor = (self.player == 'white' ? 'white' : 'dimgray');\n        self.board = Chessground(document.getElementById('__chessboard__') as HTMLElement, self.boardConfig);\n        // resize the board on the next tick, when the DOM of the chessboard has been loaded\n        requestAnimationFrame(() => {\n          self.resizeBoard();\n        });\n        configurationService.configuration.configurationChangedEmitter.addEventListener((event) => {\n          switch (event.field) {\n            case 'boardTheme': this.boardTheme = event.config.boardTheme; break;\n            case 'pieceTheme': this.pieceTheme = event.config.pieceTheme; break;\n            case 'highlightSquares': {\n              if (self.boardConfig.movable) {\n                self.board.set({\n                  movable: { showDests: event.config.highlightSquares },\n                });\n              }\n              break;\n            }\n            case 'stockfishMultiPV': self.updateStockfishMultiPV(); break;\n            case 'selectionUrl': self.loadSelectionFunction(); break;\n          }\n        });\n      }\n    }));\n\n    this.updateStockfishMultiPV();\n\n    if (this.player == 'black') this.getStockfishMove();\n  }\n\n  private updateStockfishMultiPV() {\n    stockfishService.postMessage(`setoption name MultiPV value ${configurationService.configuration.stockfishMultiPV}`);\n  }\n\n  private afterMove(orig: Key, dest: Key) {\n    if (orig == 'a0' || dest == 'a0') return;\n    // check promotion\n    if (this.chess.get(orig)?.type == 'p' && (dest.charAt(1) == '8' || dest.charAt(1) == '1')) {\n      routeService.openModal('promotion', 'promotion.html', promotionController, false, true, this.player[0]).then((data: any) => {\n        this.registerMove(orig, dest, data.piece);\n      });\n    } else {\n      this.registerMove(orig, dest, undefined);\n    }\n  }\n\n  private registerMove(source: Square, target: Square, promotion: Exclude<PieceType, \"p\" | \"k\"> | undefined) {\n    this.chess.move({\n      from: source,\n      to: target,\n      promotion: promotion\n    });\n    if (promotion)\n      this.board.set({ fen: this.chess.fen() });\n    console.log(this.chess.fen());\n    soundService.playAudio('move');\n    // this.fenHistory.push(this.chess.fen());\n    // this.fenPointer++;\n    // this.playerMoved.emit();\n    // this.initializing = false;\n    // this.prepareMove();\n\n    if (this.chess.game_over()) {\n      if (this.chess.in_checkmate()) {\n        if (this.chess.turn() == 'w') {\n          alert('negras ganan');\n        } else {\n          alert('blancas ganan');\n        }\n      } else {\n        alert('empate');\n      }\n      //this.gameOver.emit(status);\n    } else {\n      //this.playerMoved.emit();\n      this.getStockfishMove();\n    }\n\n  }\n\n  private getStockfishMove() {\n    // if (!this.stockfishWarningShowed) {\n    //     const self = this;\n    //     this.stockfishWarnTimeout = setTimeout(function() {\n    //         self.stockfishWarningShowed = true;\n    //         self.stockfishWarnTimeout = null;\n    //         self.warn.emit(self.literales['chessboard.stockfish-slow']);\n    //     }, 5000);\n    // }\n    stockfishService.postMessage('position fen ' + this.chess.fen());\n    this.listeningToStockfish = true;\n    this.stockfishMessageBuffer = [];\n    stockfishService.postMessage(`go depth ${configurationService.configuration.stockfishDepth}`);\n  }\n\n    private selectEqualizingCandidate(candidates: Candidate[]): Candidate | undefined {\n      let selected;\n      const positiveScores = candidates.filter(item => item.score >= 0);\n      const negativeScores = candidates.filter(item => item.score < 0);\n      if (positiveScores.length > 0) {\n        const minPositiveScore = Math.min(...positiveScores.map(item => item.score));\n        const minPositiveCandidates = positiveScores.filter(item => item.score === minPositiveScore);\n        // Randomly pick one from the candidates\n        const randomIndex = Math.floor(Math.random() * minPositiveCandidates.length);\n        selected = minPositiveCandidates[randomIndex];\n      } else if (negativeScores.length > 0) {\n        // Find the negative score nearest to 0\n        const maxNegativeScore = Math.max(...negativeScores.map(item => item.score));\n        const maxNegativeCandidates = negativeScores.filter(item => item.score === maxNegativeScore);\n        // Randomly pick one from the candidates\n        const randomIndex = Math.floor(Math.random() * maxNegativeCandidates.length);\n        selected = maxNegativeCandidates[randomIndex];\n      } else {\n        selected = undefined;\n      }\n      return selected;\n    }\n\n  private stockfishMessage(message: string) {\n    if (!this.listeningToStockfish) return;\n    //console.log(`STOCKFISH: ${message}`);\n    let match;\n    if (match = message.match(/^bestmove ([a-h][1-8])([a-h][1-8])([qrbn])?/)) {\n      this.listeningToStockfish = false;\n      console.log(JSON.stringify(this.stockfishMessageBuffer));\n      // Look for the lowest positive score or, if there aren't any, the closest to zero negative score\n      let selected = this.selectCandidateFunction(this.stockfishMessageBuffer);\n      if (!selected || !this.stockfishMessageBuffer.includes(selected)) return;\n      console.log(`selected: ${JSON.stringify(selected)}`);\n      this.updateGauge(selected.score);\n      // TO DO: promotion\n      const from = selected.pv.substring(0, 2);\n      const to = selected.pv.substring(2, 4);\n      const piece = (selected.pv.length == 5 && (selected.pv[4] == 'r' || selected.pv[4] == 'n' || selected.pv[4] == 'b' || selected.pv[4] == 'q') ? selected.pv[4] : undefined)\n      this.chess.move({ from: from as Square, to: to as Square, promotion: piece });\n      //this.board.move(from as Key, to as Key);\n      const turn = this.chess.turn() === 'w' ? 'white' : 'black';\n      this.board.set({\n        fen: this.chess.fen(),\n        turnColor: turn,\n        movable: {\n          color: turn,\n          dests: this.toDests()\n        }\n      });\n      console.log(this.chess.fen());\n      soundService.playAudio('move');\n    } else if (match = message.match(/^info depth (\\d+) .*score cp (-?\\d+) .*pv (\\w+\\d\\w+)/)) {\n      const depth = parseInt(match[1]);\n      const score = parseInt(match[2]);\n      const pv = match[3];\n      this.updateGauge(score);\n      if (depth == configurationService.configuration.stockfishDepth) {\n        //console.log(`depth=${depth} score=${score} pv=${pv}`);\n        this.stockfishMessageBuffer.push({ score: score, pv: pv });\n        console.log(`score: ${score}`);\n      }\n\n      //let engineScore;\n      // if (match[1] == 'cp') { /// Is it measuring in centipawns?\n      //     engineScore = (score / 100.0).toFixed(2);\n      //     self.stockfishMessageBuffer.push(message);\n      // } else if (match[1] == 'mate') { /// Did it find a mate?\n\n      // }\n    }\n  }\n\n  private updateGauge(score: number) {\n    const ev = this.povChances(this.engine, undefined, score);\n    console.log(`povChances: ${ev}`);\n    const gaugeTop = document.querySelector('.gauge_top') as HTMLElement;\n    const gaugeBottom = document.querySelector('.gauge_bottom') as HTMLElement;\n    const blackHeight = 100 - (ev + 1) * 50;\n    const whiteHeight = 100 - blackHeight;\n    gaugeTop.style.height = `${(this.player == 'white' ? blackHeight : whiteHeight)}%`;\n    gaugeBottom.style.height = `${(this.player == 'white' ? whiteHeight : blackHeight)}%`;\n  }\n\n  getSEOParams(): any {\n    return { 'kind': this.seo };\n  }\n\n  onExit(): Promise<boolean> {\n    return new Promise<boolean>(async resolve => {\n      const alert = await alertController.create({\n        header: window.AlpineI18n.t('position.confirm-exit.header'),\n        message: window.AlpineI18n.t('position.confirm-exit.message'),\n        buttons: [\n          {\n            text: window.AlpineI18n.t('position.confirm-exit.no'),\n            role: 'cancel',\n            cssClass: 'overlay-button',\n            handler: () => {\n              resolve(false);\n            }\n          }, {\n            text: window.AlpineI18n.t('position.confirm-exit.yes'),\n            cssClass: 'overlay-button',\n            handler: () => {\n              stockfishService.postMessage('stop');\n              resolve(true);\n            }\n          }\n        ]\n      });\n      alert.present();\n    });\n  }\n\n  // https://github.com/lichess-org/lila/blob/master/ui/ceval/src/winningChances.ts\n  private toPov(color: Color, diff: number): number {\n    return (color === 'white' ? diff : -diff);\n  }\n  private rawWinningChances(cp: number): number {\n    const MULTIPLIER = -0.00368208; // https://github.com/lichess-org/lila/pull/11148\n    return 2 / (1 + Math.exp(MULTIPLIER * cp)) - 1;\n  };\n  private mateWinningChances(mate: number): number {\n    const cp = (21 - Math.min(10, Math.abs(mate))) * 100;\n    const signed = cp * (mate > 0 ? 1 : -1);\n    return this.rawWinningChances(signed);\n  };\n  private cpWinningChances(cp: number): number {\n    return this.rawWinningChances(Math.min(Math.max(-1000, cp), 1000));\n  }\n  private evalWinningChances(evMate?: number, evCp?: number): number {\n    return typeof evMate !== 'undefined' ? this.mateWinningChances(evMate) : this.cpWinningChances(evCp!);\n  }\n  private povChances(color: Color, evMate?: number, evCp?: number): number {\n    return this.toPov(color, this.evalWinningChances(evMate, evCp));\n  }\n\n\n}\n\nexport const positionController = new PositionController();\n","import { appController, homeController, aboutController, settingsController, positionController, promotionController } from './controllers';\n\nexport const ROUTE_MAP = {\n    hash: true,\n    mainRoute: {\n        path: '/equalizing-chess/',\n        template: 'app.html',\n        tag: 'ion-app',\n        controller: appController,\n        hasParams: false\n    },\n    routes: [\n        {\n            path: '/',\n            template: 'home.html',\n            tag: 'ion-router-outlet',\n            controller: homeController,\n            hasParams: false\n        },\n        {\n            path: '/home',\n            template: 'home.html',\n            tag: 'ion-router-outlet',\n            controller: homeController,\n            hasParams: false\n        },\n        {\n            path: '/about',\n            template: 'about.html',\n            tag: 'ion-router-outlet',\n            controller: aboutController,\n            hasParams: false\n        },\n        {\n            path: '/settings',\n            template: 'settings.html',\n            tag: 'ion-router-outlet',\n            controller: settingsController,\n            hasParams: false\n        },\n        {\n            path: '/game/:color',\n            template: 'position.html',\n            tag: 'ion-router-outlet',\n            controller: positionController,\n            hasParams: true\n        },\n        {\n            path: '/fen/:fen1/:fen2/:fen3/:fen4/:fen5/:fen6/:fen7/:fen8',\n            template: 'position.html',\n            tag: 'ion-router-outlet',\n            controller: positionController,\n            hasParams: true\n        },\n        {\n            path: '/promotion',\n            template: 'promotion.html',\n            tag: 'ion-router-outlet',\n            controller: promotionController,\n            hasParams: false\n        }\n    ]\n};\n","import './styles';\n\nimport { services_initialize, routeService } from './services';\nimport { ROUTE_MAP } from './routes';\n\nservices_initialize().then(() => { routeService.init(ROUTE_MAP); });\n"],"file":"assets/index-DnyO3rib.js"}